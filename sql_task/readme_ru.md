# SQL –ó–∞–¥–∞—á–∞ ‚Äì –ò–Ω–∂–µ–Ω–µ—Ä–∏—è –ü—Ä–∏–∑–Ω–∞–∫–æ–≤ –¥–ª—è –Ω–æ–≤–æ–π –º–æ–¥–µ–ª–∏

–ù–∞—à–∞ –∫–æ–º–∞–Ω–¥–∞ –ø–æ –∞–Ω–∞–ª–∏–∑—É –¥–∞–Ω–Ω—ã—Ö –ø–æ–¥–≥–æ—Ç–æ–≤–∏–ª–∞ –Ω–æ–≤—É—é –º–æ–¥–µ–ª—å —Å–∫–æ—Ä–∏–Ω–≥–∞, –∏ —Ç–µ–ø–µ—Ä—å –µ—ë –Ω—É–∂–Ω–æ –∫–∞–∫ –º–æ–∂–Ω–æ –±—ã—Å—Ç—Ä–µ–µ –≤–Ω–µ–¥—Ä–∏—Ç—å –≤ –ø—Ä–æ–¥–∞–∫—à–Ω üöÄ

---

## üéØ –¶–µ–ª—å

–î–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ —Ä–∞—Å—Å—á–∏—Ç–∞–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ –º–æ–¥–µ–ª–∏. –í—Å–µ —Ä–∞—Å—á—ë—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω—ã —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º SQL.

| –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–∞                                 | –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–∞                                                                                                                                        |
| ------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `vendor_microfinance_gambling_payment_ratio_l12m` | –û—Ç–Ω–æ—à–µ–Ω–∏–µ –æ–±—â–µ–π —Å—É–º–º—ã –ø–ª–∞—Ç–µ–∂–µ–π –º–∏–∫—Ä–æ—Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–º –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º –∏ –∏–≥–æ—Ä–Ω—ã–º –∑–∞–≤–µ–¥–µ–Ω–∏—è–º –∫ –æ–±—â–µ–π —Å—É–º–º–µ –≤—Å–µ—Ö –ø–ª–∞—Ç–µ–∂–µ–π –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞–º –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 12 –º–µ—Å—è—Ü–µ–≤         |
| `vendor_grocery_utilities_transaction_ratio_l9m`  | –û—Ç–Ω–æ—à–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏ –∏ –∫–æ–º–º—É–Ω–∞–ª—å–Ω—ã–º–∏ —É—Å–ª—É–≥–∞–º–∏, –∫ –æ–±—â–µ–º—É –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –≤—Å–µ—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞–º –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 9 –º–µ—Å—è—Ü–µ–≤ |
| `history_payment_delay_flag_l6m`                  | –õ–æ–≥–∏—á–µ—Å–∫–∏–π —Ñ–ª–∞–≥, —É–∫–∞–∑—ã–≤–∞—é—â–∏–π, –±—ã–ª–∞ –ª–∏ –∑–∞–¥–µ—Ä–∂–∫–∞ –ø–æ –ª—é–±–æ–º—É –ø–ª–∞—Ç–µ–∂—É –ø–æ –∫—Ä–µ–¥–∏—Ç—É –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 6 –º–µ—Å—è—Ü–µ–≤                                                       |
| `history_payment_ratio_l9m_to_total`              | –û—Ç–Ω–æ—à–µ–Ω–∏–µ –æ–±—â–µ–π —Å—É–º–º—ã –ø–ª–∞—Ç–µ–∂–µ–π —Ç–∏–ø–∞ "–¥–æ—Ö–æ–¥" –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 9 –º–µ—Å—è—Ü–µ–≤ –∫ –æ–±—â–µ–π –∏—Å—Ç–æ—Ä–∏–∏ –ø–ª–∞—Ç–µ–∂–µ–π                                                              |
| `history_average_loan_profit_margin_l12m`         | –°—Ä–µ–¥–Ω—è—è –º–∞—Ä–∂–∞ –ø—Ä–∏–±—ã–ª–∏ (—Å—É–º–º–∞ –∫—Ä–µ–¥–∏—Ç–∞ - –æ–±—â–∞—è —Å—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–µ–π) / —Å—É–º–º–∞ –∫—Ä–µ–¥–∏—Ç–∞ –¥–ª—è –∫—Ä–µ–¥–∏—Ç–æ–≤, –≤—ã–¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 12 –º–µ—Å—è—Ü–µ–≤                              |
|                                                   |

–ï—Å–ª–∏ —É –∫–ª–∏–µ–Ω—Ç–∞ –Ω–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—Ä–∏–∑–Ω–∞–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∏–ª–∏ –ø–ª–∞—Ç–µ–∂–µ–π –∑–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥), –∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤–æ–∑–≤—Ä–∞—â–µ–Ω–æ –∫–∞–∫ NULL.

---

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö **SQLite** —Å —á–µ—Ç—ã—Ä—å–º—è –æ—Å–Ω–æ–≤–Ω—ã–º–∏ —Ç–∞–±–ª–∏—Ü–∞–º–∏: `clients`, `loans`, `cash_flows` –∏ `vendor_transactions`.

### üßë‚Äçüíº `clients`

–°–æ–¥–µ—Ä–∂–∏—Ç –æ—Å–Ω–æ–≤–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–ª–∏–µ–Ω—Ç–∞—Ö.

| –ü–æ–ª–µ           | –¢–∏–ø     | –û–ø–∏—Å–∞–Ω–∏–µ                                                       |
| -------------- | ------- | -------------------------------------------------------------- |
| `id`           | Integer | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∫–ª–∏–µ–Ω—Ç–∞                               |
| `first_name`   | String  | –ò–º—è –∫–ª–∏–µ–Ω—Ç–∞                                                    |
| `last_name`    | String  | –§–∞–º–∏–ª–∏—è –∫–ª–∏–µ–Ω—Ç–∞                                                |
| `phone_number` | String  | –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–≤—è–∑–∏ —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏) |
| `email`        | String  | –≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞ –∫–ª–∏–µ–Ω—Ç–∞                                      |

---

### üí≥ `loans`

–°–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫—Ä–µ–¥–∏—Ç–∞—Ö, –≤—ã–¥–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–∞–º.

| –ü–æ–ª–µ             | –¢–∏–ø     | –û–ø–∏—Å–∞–Ω–∏–µ                         |
| ---------------- | ------- | -------------------------------- |
| `id`             | Integer | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∫—Ä–µ–¥–∏—Ç–∞ |
| `client_id`      | Integer | –í–Ω–µ—à–Ω–∏–π –∫–ª—é—á –∫ `clients.id`      |
| `amount`         | Numeric | –°—É–º–º–∞ –∫—Ä–µ–¥–∏—Ç–∞                    |
| `payment_amount` | Numeric | –°—É–º–º–∞ –µ–∂–µ–º–µ—Å—è—á–Ω–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞       |
| `term`           | Integer | –°—Ä–æ–∫ –∫—Ä–µ–¥–∏—Ç–∞ (–≤ –º–µ—Å—è—Ü–∞—Ö)         |
| `start_date`     | Date    | –î–∞—Ç–∞ –≤—ã–¥–∞—á–∏ –∫—Ä–µ–¥–∏—Ç–∞              |

---

### üí∏ `cash_flows`

–°–æ–¥–µ—Ä–∂–∏—Ç –∑–∞–ø–∏—Å–∏ –æ –¥–≤–∏–∂–µ–Ω–∏–∏ –¥–µ–Ω–µ–∂–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å –∫—Ä–µ–¥–∏—Ç–∞–º–∏.

| –ü–æ–ª–µ             | –¢–∏–ø     | –û–ø–∏—Å–∞–Ω–∏–µ                        |
| ---------------- | ------- | ------------------------------- |
| `id`             | Integer | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∑–∞–ø–∏—Å–∏ |
| `loan_id`        | Integer | –í–Ω–µ—à–Ω–∏–π –∫–ª—é—á –∫ `loans.id`       |
| `type`           | String  | `"income"` –∏–ª–∏ `"expense"`      |
| `amount`         | Numeric | –°—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–∞                   |
| `scheduled_date` | Date    | –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–∞—Ç–∞ –ø–ª–∞—Ç–µ–∂–∞    |
| `payment_date`   | Date    | –§–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –¥–∞—Ç–∞ –ø–ª–∞—Ç–µ–∂–∞        |

> `expense` = –≤—ã–¥–∞—á–∞ –∫—Ä–µ–¥–∏—Ç–∞, `income` = –ø–ª–∞—Ç–µ–∂ –∫–ª–∏–µ–Ω—Ç–∞.

---

### üè™ `vendor_transactions`

–ü—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –≤–Ω–µ—à–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –º–∞–≥–∞–∑–∏–Ω–∞–º–∏ –∏–ª–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏).

| –ü–æ–ª–µ               | –¢–∏–ø     | –û–ø–∏—Å–∞–Ω–∏–µ                                                    |
| ------------------ | ------- | ----------------------------------------------------------- |
| `id`               | UUID    | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏                         |
| `phone_number`     | String  | –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–≤—è–∑–∏ —Å `clients`) |
| `amount`           | Numeric | –°—É–º–º–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏                                            |
| `merchant`         | String  | –ù–∞–∑–≤–∞–Ω–∏–µ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞/–ø—Ä–æ–¥–∞–≤—Ü–∞                                |
| `transaction_date` | Date    | –î–∞—Ç–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏                                             |

---

## üß† –ü—Ä–∏–º–µ—á–∞–Ω–∏—è –∫ –¥–∞–Ω–Ω—ã–º

- **–ü—Ä–∏–∑–Ω–∞–∫–∏ –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ (`vendor_*`)**: –≤—ã—á–∏—Å–ª—è—é—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–∞–±–ª–∏—Ü—ã `vendor_transactions`. –ü—Ä–∏–º–µ—Ä—ã:

  - `vendor_microfinance_gambling_payment_ratio_l12m`
  - `vendor_grocery_utilities_transaction_ratio_l9m`

- **–ü—Ä–∏–∑–Ω–∞–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏ (`history_*`)**: —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–∞–±–ª–∏—Ü `loans` –∏ `cash_flows`. –ü—Ä–∏–º–µ—Ä—ã:

  - `history_payment_delay_flag_l6m`
  - `history_payment_ratio_l9m_to_total`

- **–ú–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤**: –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Å **–∑–∞–º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –∏–º–µ–Ω–∞–º–∏**, –Ω–∞–ø—Ä–∏–º–µ—Ä:

  - `"CASINOSLOTS"` ‚Üí `"CA*****S"`
  - `"FASTMONEY"` ‚Üí `"FA*****Y"`

  –≠—Ç–∏ —Å–ª—É—á–∞–∏ —Å–ª–µ–¥—É–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —á–∞—Å—Ç–∏—á–Ω–æ–≥–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è (`LIKE`, —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –∏ —Ç.–¥.).

- **–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤**: –¥–æ—Å—Ç—É–ø–Ω—ã –≤–æ –≤–Ω–µ—à–Ω–µ–º —Ñ–∞–π–ª–µ `fake_merchants.json`.

- **–°–≤—è–∑—ã–≤–∞–Ω–∏–µ `vendor_transactions` —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏**: –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ –ø–æ–ª–µ `phone_number`, –∞ –Ω–µ —á–µ—Ä–µ–∑ `client_id`.

---

## üõ† –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

–ü–∏—à–∏—Ç–µ –≤–∞—à SQL –≤ —Ñ–∞–π–ª–µ query.sql.
–ó–∞–ø—Ä–æ—Å –¥–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å client_id –∏ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ –≤ –≤–∏–¥–µ –∫–æ–ª–æ–Ω–æ–∫.

–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ, –≤—ã–ø–æ–ª–Ω–∏–≤ –∫–æ–º–∞–Ω–¥—É –∏–∑ –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:

```bash
python -m sql_task.data_generator
```

–≠—Ç–æ —Å–æ–∑–¥–∞—Å—Ç —Ñ–∞–π–ª –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Å–æ –≤—Å–µ–º–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º–∏ —Ç–∞–±–ª–∏—Ü–∞–º–∏ –∏ —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏.

–ó–∞—Ç–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫—É –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤–∞—à–µ–≥–æ —Ä–µ—à–µ–Ω–∏—è:

```bash
python -m sql_task.runner
```

–≠—Ç–æ –≤—ã–ø–æ–ª–Ω–∏—Ç –≤–∞—à –∑–∞–ø—Ä–æ—Å –¥–ª—è –æ–¥–Ω–æ–≥–æ —Å–ª—É—á–∞–π–Ω–æ–≥–æ client_id –∏ –≤—ã–≤–µ–¥–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –∫–æ–Ω—Å–æ–ª—å.

> –ó–∞–ø—Ä–æ—Å –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞, —Å –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–æ–π :client_id –≤ —Ä–∞–Ω–Ω–µ—Ä–µ.
> –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ —Ä–∞—Å—á—ë—Ç—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–º –∫–ª–∏–µ–Ω—Ç–æ–º –∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç —Ä–æ–≤–Ω–æ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É –∑–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ.
